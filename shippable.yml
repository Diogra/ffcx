language: python
python:
  - 2.7
  - 3.6

build:
  ci:
    - if [ "$BRANCH" == "next" ] ; then export DEP_BRANCH_NAME="next" ; else export DEP_BRANCH_NAME="master" ; fi

    - apt-get -qq -y --no-install-recommends install cmake
    - pip install --upgrade pip
    - pip install flake8 pybind11 pytest
    - pip install git+https://bitbucket.org/fenics-project/fiat.git@"${DEP_BRANCH_NAME}"
    - pip install git+https://bitbucket.org/fenics-project/ufl.git@"${DEP_BRANCH_NAME}"
    - pip install git+https://bitbucket.org/fenics-project/dijitso.git@"${DEP_BRANCH_NAME}"

    - pip install -e .
    - pip install libs/ffc-factory/

    - python -m flake8 ffc/

    - mkdir -p shippable/testresults
    - python -m pytest --junitxml=shippable/testresults/nosetests.xml ./test/unit
    - python -m pytest -v ./test/uflacs

    - cd test/regression
    - python test.py